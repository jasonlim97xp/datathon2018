<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Datathon - DTT</title>
    <!-- Bootstrap core CSS-->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
    <!-- Page level plugin CSS-->
    <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="css/sb-admin.css" rel="stylesheet">
    <link href="jgod.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src= "https://cdn.zingchart.com/zingchart.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

</head>

<body id="page-top">
    <div id="wrapper" style="background-color:#111111">
        <div id="content-wrapper">

            <!-- Row 1-->
            <div class="container-fluid">
                <h3 style="margin:30px 0px 0px 0px;font-family: 'Source Sans Pro', sans-serif; text-align: center; font-size: 40px">ESTIMATED POPULATION STRUCTURE IN THE YEAR 2040</h3>
                <h4 style="text-align: center; margin-bottom: 30px; color:white;  ">By: DTT</h4>
                <div class="row">
                    <div class="col-lg-1"></div>
                    <div class="panel panel-default col-lg-10" style="background-color: white">
                        <div class="panel-body">

                            <h5 style="margin:20px 0px 40px 0px; color:#AF1D22">Projected population based on gender and age (2015-2040)</h5>
                            
                                <div class="slider" style="margin-left: auto; margin-right: auto">

                                    <div class="slide" id="slide-1">
                                        <div id="2015" style="min-width: auto; height:600px; margin: 0 auto"></div>
                                    </div>

                                    <div class="slide" id="slide-2">
                                        <div id="2020" style="min-width: 310px; max-width: 900px; height:600px; margin: 0 auto"></div>
                                    </div>

                                    <div class="slide" id="slide-3">
                                        <div id="2025" style="min-width: 310px; max-width: 900px; height:600px; margin: 0 auto"></div>
                                    </div>

                                    <div class="slide" id="slide-4">
                                        <div id="2030" style="min-width: 310px; max-width: 900px; height:600px; margin: 0 auto"></div>
                                    </div>

                                    <div class="slide" id="slide-5">
                                        <div id="2035" style="min-width: 310px; max-width: 900px; height:600px; margin: 0 auto"></div>
                                    </div>

                                    <div class="slide" id="slide-6">
                                        <div id="2040" style="min-width: 310px; max-width: 900px; height:600px; margin: 0 auto"></div>
                                    </div>
                                </div>
                        </div>
                    </div>
                    <div class="col-lg-1"></div>
                </div>
            </div>

            <br>

            <!--Row 2-->
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-1"></div>
                    <div class="panel panel-default col-lg-6" style="background-color: white">
                        <div class="panel-body">
                            <h5 style="margin:10px 0px 20px 0px">Projected population based on age group (2015-2040)</h4>
                                <!--Jason is a god-->
                                <div id="myChart" style="display: block; margin-left: 15%"></div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default col-lg-4" style="margin-left:10px; background-color: white">
                        <div class="panel-body">
                            <h5 style="margin:10px">Projected working and non-working population in 2040</h4>
                                <!--Working & Non Working Function-->
                                <div id="doughnutChart" class="chart"></div>
                        </div>
                    </div>
                    <div class="col-lg-1"></div>
                </div>
            </div>

            <br>

            <!--Row 3-->
            <div class="container-fluid">

                <div class="row">
                    <div class="col-lg-1"></div>
                    <div class="panel panel-default col-lg-10" style="background-color: white">
                        <div class="panel-body">
                            <h5 style="margin:20px 0px 0px 0px">Projected population based on states in 2040 </h5>
                            <h6 style="text-align: center; color:darkgrey; font-style: italic">Population ranking based on states</h6>
                            
                                <!--State Map Function-->
                                <div id="map" style="margin-left:3%; margin-right: 3%"></div>
                        </div>
                    </div>
                    <div class="col-lg-1"></div>
                </div>
            </div>
            
            <br>
            
            <!--Disclaimer-->
            <div class="col-lg-11">
                <h6 style="text-align: right; color:white; font-style: italic">* All values per thousand</h5>
            </div>

        </div>
    </div>
    <!-- /.container-fluid -->
    </div>
    <!-- /.content-wrapper -->
    </div>
    <!-- /#wrapper -->


    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Page level plugin JavaScript-->
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/datatables/jquery.dataTables.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin.min.js"></script>

    <!--Map Initialize-->
    <script type="text/javascript" src="mapdata.js"></script>
    <script type="text/javascript" src="countrymap.js"></script>

    <!--Cool stuffs here-->
    <script>
        
        //Pyramid function
        var categories = [
            '0-4', '5-9', '10-14', '15-19',
            '20-24', '25-29', '30-34', '35-39', '40-44',
            '45-49', '50-54', '55-59', '60-64', '65-69',
            '70-74', '75-79', '80+'
        ];
        Highcharts.chart('2015', {
            chart: {
                type: 'bar'
            },
            title: {
                text: '2015'
            },
            subtitle: {
                text: 'Source: <a href="https://www.dosm.gov.my/v1/index.php?r=column/cone&menu_id=Nk1JZnJBMm1TdmRFS0xaTXZnanIrQT09">DOSM Population Quick Info</a>'
            },
            xAxis: [{
                categories: categories,
                reversed: false,
                labels: {
                    step: 1
                }
            }, { // mirror axis on right side
                opposite: true,
                reversed: false,
                categories: categories,
                linkedTo: 0,
                labels: {
                    step: 1
                }
            }],
            yAxis: {
                title: {
                    text: null
                },
                labels: {
                    formatter: function() {
                        return Math.abs(this.value);
                    }
                }
            },

            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                        'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 2);
                }
            },

            series: [{
                name: 'Male',
                data: [
                    -1344.40, -1294.30, -1363.50, -1472.60, -1692.60, -1668.80, -1441.40, -1138.90, -973.6, -868.8, -804.7, -662.7, -504.1, -370.2, -225, -151.2, -135.4
                ]
            }, {
                name: 'Female',
                data: [
                    1257.30, 1224.10, 1292.30, 1374.10, 1532.90, 1467.10, 1289.80, 1019.30, 925.2, 859.1, 755.6, 641.5, 496.3, 378.4, 235.9, 168.4, 157
                ]
            }]
        });
        Highcharts.chart('2020', {
            chart: {
                type: 'bar'
            },
            title: {
                text: '2020'
            },
            subtitle: {
                text: 'Source: <a href="https://www.dosm.gov.my/v1/index.php?r=column/cone&menu_id=Nk1JZnJBMm1TdmRFS0xaTXZnanIrQT09">DOSM Population Quick Info</a>'
            },
            xAxis: [{
                categories: categories,
                reversed: false,
                labels: {
                    step: 1
                }
            }, { // mirror axis on right side
                opposite: true,
                reversed: false,
                categories: categories,
                linkedTo: 0,
                labels: {
                    step: 1
                }
            }],
            yAxis: {
                title: {
                    text: null
                },
                labels: {
                    formatter: function() {
                        return Math.abs(this.value);
                    }
                }
            },

            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                        'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 2);
                }
            },

            series: [{
                name: 'Male',
                data: [
                    -1403.90, -1384.60, -1275.40, -1410.70, -1413.10, -1499.50, -1613.50, -1609.10, -1244.90, -1061.40, -922.6, -825, -669.5, -487.4, -344.2, -197.5, -173.4
                ]
            }, {
                name: 'Female',
                data: [
                    1327.20, 1306.90, 1213.80, 1327.80, 1334.20, 1409.80, 1461.50, 1356.70, 1043.40, 951.6, 879.1, 757.7, 636.8, 471.1, 349.8, 208.4, 211
                ]
            }]
        });
        Highcharts.chart('2025', {
            chart: {
                type: 'bar'
            },
            title: {
                text: '2025'
            },
            subtitle: {
                text: 'Source: <a href="https://www.dosm.gov.my/v1/index.php?r=column/cone&menu_id=Nk1JZnJBMm1TdmRFS0xaTXZnanIrQT09">DOSM Population Quick Info</a>'
            },
            xAxis: [{
                categories: categories,
                reversed: false,
                labels: {
                    step: 1
                }
            }, { // mirror axis on right side
                opposite: true,
                reversed: false,
                categories: categories,
                linkedTo: 0,
                labels: {
                    step: 1
                }
            }],
            yAxis: {
                title: {
                    text: null
                },
                labels: {
                    formatter: function() {
                        return Math.abs(this.value);
                    }
                }
            },

            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                        'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 2);
                }
            },

            series: [{
                name: 'Male',
                data: [
                    -1395.00, -1401.10, -1383.20, -1339.60, -1423.00, -1422.90, -1501.10, -1625.70, -1617.00, -1247.10, -1054.00, -907.8, -798, -624.2, -440, -291.4, -230.8
                ]
            }, {
                name: 'Female',
                data: [
                    1320.60, 1324.10, 1305.60, 1256.10, 1336.40, 1337.80, 1406.60, 1460.90, 1355.30, 1039.20, 946.2, 868.8, 741.4, 598.7, 439.2, 308.8, 274.8
                ]
            }]
        });
        Highcharts.chart('2030', {
            chart: {
                type: 'bar'
            },
            title: {
                text: '2030'
            },
            subtitle: {
                text: 'Source: <a href="https://www.dosm.gov.my/v1/index.php?r=column/cone&menu_id=Nk1JZnJBMm1TdmRFS0xaTXZnanIrQT09">DOSM Population Quick Info</a>'
            },
            xAxis: [{
                categories: categories,
                reversed: false,
                labels: {
                    step: 1
                }
            }, { // mirror axis on right side
                opposite: true,
                reversed: false,
                categories: categories,
                linkedTo: 0,
                labels: {
                    step: 1
                }
            }],
            yAxis: {
                title: {
                    text: null
                },
                labels: {
                    formatter: function() {
                        return Math.abs(this.value);
                    }
                }
            },

            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                        'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 2);
                }
            },

            series: [{
                name: 'Male',
                data: [
                    -1361.80, -1391.40, -1398.90, -1455.40, -1354.50, -1431.40, -1422.70, -1500.90, -1628.00, -1620.50, -1241.20, -1040.70, -883, -748.3, -570.8, -378.5, -336.6
                ]
            }, {
                name: 'Female',
                data: [
                    1291.00, 1317.00, 1322.10, 1353.40, 1266.20, 1338.30, 1333.50, 1400.50, 1457.20, 1348.10, 1032.90, 936.3, 852.1, 700.9, 561.5, 391.6, 395.2
                ]
            }]
        });
        Highcharts.chart('2035', {
            chart: {
                type: 'bar'
            },
            title: {
                text: '2035'
            },
            subtitle: {
                text: 'Source: <a href="https://www.dosm.gov.my/v1/index.php?r=column/cone&menu_id=Nk1JZnJBMm1TdmRFS0xaTXZnanIrQT09">DOSM Population Quick Info</a>'
            },
            xAxis: [{
                categories: categories,
                reversed: false,
                labels: {
                    step: 1
                }
            }, { // mirror axis on right side
                opposite: true,
                reversed: false,
                categories: categories,
                linkedTo: 0,
                labels: {
                    step: 1
                }
            }],
            yAxis: {
                title: {
                    text: null
                },
                labels: {
                    formatter: function() {
                        return Math.abs(this.value);
                    }
                }
            },

            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                        'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 2);
                }
            },

            series: [{
                name: 'Male',
                data: [
                    -1317.40, -1358.30, -1389.00, -1479.20, -1473.10, -1362.30, -1430.60, -1421.60, -1492.70, -1626.90, -1615.90, -1230.20, -1018.60, -834.8, -692.5, -499.9, -470
                ]
            }, {
                name: 'Female',
                data: [
                    1250.60, 1287.60, 1314.90, 1376.00, 1365.10, 1267.00, 1333.20, 1327.10, 1392.60, 1448.60, 1339.60, 1023.10, 921, 809.9, 662.6, 506.1, 541.1

                ]
            }]
        });
        Highcharts.chart('2040', {
            chart: {
                type: 'bar'
            },
            title: {
                text: '2040'
            },
            subtitle: {
                text: 'Source: <a href="https://www.dosm.gov.my/v1/index.php?r=column/cone&menu_id=Nk1JZnJBMm1TdmRFS0xaTXZnanIrQT09">DOSM Population Quick Info</a>'
            },
            xAxis: [{
                categories: categories,
                reversed: false,
                labels: {
                    step: 1
                }
            }, { // mirror axis on right side
                opposite: true,
                reversed: false,
                categories: categories,
                linkedTo: 0,
                labels: {
                    step: 1
                }
            }],
            yAxis: {
                title: {
                    text: null
                },
                labels: {
                    formatter: function() {
                        return Math.abs(this.value);
                    }
                }
            },

            plotOptions: {
                series: {
                    stacking: 'normal'
                }
            },

            tooltip: {
                formatter: function() {
                    return '<b>' + this.series.name + ', age ' + this.point.category + '</b><br/>' +
                        'Population: ' + Highcharts.numberFormat(Math.abs(this.point.y), 2);
                }
            },

            series: [{
                name: 'Male',
                data: [
                    -1293.90, -1313.90, -1355.70, -1477.30, -1499.30, -1480.00, -1360.90, -1429.00, -1412.80, -1481.90, -1617.60, -1605.50, -1210.70, -971.3, -783.1, -617.1, -652.8
                ]
            }, {
                name: 'Female',
                data: [
                    1230.30, 1247.10, 1285.30, 1374.70, 1389.00, 1364.70, 1261.30, 1326.30, 1319.70, 1380.30, 1439.00, 1327.10, 1008.20, 879.7, 771.4, 604.5, 731.9
                ]
            }]
        });    
        
        //Doughnut function
        $(function() {
            $("#doughnutChart").drawDoughnutChart([{
                title: "Non-Working Age",
                value: 13738,
                color: "#218BC9"
                },
                {

                    title: "Working Age",
                    value: 27765.30,
                    color: "#FC4349"
                },
            ]);
        });
        (function($, undefined) {
            $.fn.drawDoughnutChart = function(data, options) {
                var $this = this,
                    W = $this.width(),
                    H = $this.height(),
                    centerX = W / 2,
                    centerY = H / 2,
                    cos = Math.cos,
                    sin = Math.sin,
                    PI = Math.PI,
                    settings = $.extend({
                        segmentShowStroke: true,
                        segmentStrokeColor: "#0C1013",
                        segmentStrokeWidth: 0.5,
                        baseColor: "rgba(255,255,255,0.9)",
                        baseOffset: 4,
                        edgeOffset: 10, //offset from edge of $this
                        percentageInnerCutout: 75,
                        animation: true,
                        animationSteps: 90,
                        animationEasing: "easeInOutExpo",
                        animateRotate: true,
                        tipOffsetX: -8,
                        tipOffsetY: -45,
                        tipClass: "doughnutTip",
                        summaryClass: "doughnutSummary",
                        summaryTitle: "Total Estimated Population:",
                        summaryTitleClass: "doughnutSummaryTitle",
                        summaryNumberClass: "doughnutSummaryNumber",
                        beforeDraw: function() {},
                        afterDrawed: function() {},
                        onPathEnter: function(e, data) {},
                        onPathLeave: function(e, data) {}
                    }, options),
                    animationOptions = {
                        linear: function(t) {
                            return t;
                        },
                        easeInOutExpo: function(t) {
                            var v = t < .5 ? 8 * t * t * t * t : 1 - 8 * (--t) * t * t * t;
                            return (v > 1) ? 1 : v;
                        }
                    },
                    requestAnimFrame = function() {
                        return window.requestAnimationFrame ||
                            window.webkitRequestAnimationFrame ||
                            window.mozRequestAnimationFrame ||
                            window.oRequestAnimationFrame ||
                            window.msRequestAnimationFrame ||
                            function(callback) {
                                window.setTimeout(callback, 1000 / 60);
                            };
                    }();

                settings.beforeDraw.call($this);

                var $svg = $('<svg width="' + W + '" height="' + H + '" viewBox="0 0 ' + W + ' ' + H + '" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>').appendTo($this),
                    $paths = [],
                    easingFunction = animationOptions[settings.animationEasing],
                    doughnutRadius = Min([H / 2, W / 2]) - settings.edgeOffset,
                    cutoutRadius = doughnutRadius * (settings.percentageInnerCutout / 100),
                    segmentTotal = 0;

                //Draw base doughnut
                var baseDoughnutRadius = doughnutRadius + settings.baseOffset,
                    baseCutoutRadius = cutoutRadius - settings.baseOffset;
                $(document.createElementNS('http://www.w3.org/2000/svg', 'path'))
                    .attr({
                        "d": getHollowCirclePath(baseDoughnutRadius, baseCutoutRadius),
                        "fill": settings.baseColor
                    })
                    .appendTo($svg);

                //Set up pie segments wrapper
                var $pathGroup = $(document.createElementNS('http://www.w3.org/2000/svg', 'g'));
                $pathGroup.attr({
                    opacity: 0
                }).appendTo($svg);

                //Set up tooltip
                var $tip = $('<div class="' + settings.tipClass + '" />').appendTo('body').hide(),
                    tipW = $tip.width(),
                    tipH = $tip.height();

                //Set up center text area
                var summarySize = (cutoutRadius - (doughnutRadius - cutoutRadius)) * 2,
                    $summary = $('<div class="' + settings.summaryClass + '" />')
                    .appendTo($this)
                    .css({
                        width: summarySize + "px",
                        height: summarySize + "px",
                        "margin-left": -(summarySize / 2) + "px",
                        "margin-top": -(summarySize / 2) + "px"
                    });
                var $summaryTitle = $('<p class="' + settings.summaryTitleClass + '">' + settings.summaryTitle + '</p>').appendTo($summary);
                var $summaryNumber = $('<p class="' + settings.summaryNumberClass + '"></p>').appendTo($summary).css({
                    opacity: 0
                });

                for (var i = 0, len = data.length; i < len; i++) {
                    segmentTotal += data[i].value;
                    $paths[i] = $(document.createElementNS('http://www.w3.org/2000/svg', 'path'))
                        .attr({
                            "stroke-width": settings.segmentStrokeWidth,
                            "stroke": settings.segmentStrokeColor,
                            "fill": data[i].color,
                            "data-order": i
                        })
                        .appendTo($pathGroup)
                        .on("mouseenter", pathMouseEnter)
                        .on("mouseleave", pathMouseLeave)
                        .on("mousemove", pathMouseMove);
                }

                //Animation start
                animationLoop(drawPieSegments);

                //Functions
                function getHollowCirclePath(doughnutRadius, cutoutRadius) {
                    //Calculate values for the path.
                    //We needn't calculate startRadius, segmentAngle and endRadius, because base doughnut doesn't animate.
                    var startRadius = -1.570, // -Math.PI/2
                        segmentAngle = 6.2831, // 1 * ((99.9999/100) * (PI*2)),
                        endRadius = 4.7131, // startRadius + segmentAngle
                        startX = centerX + cos(startRadius) * doughnutRadius,
                        startY = centerY + sin(startRadius) * doughnutRadius,
                        endX2 = centerX + cos(startRadius) * cutoutRadius,
                        endY2 = centerY + sin(startRadius) * cutoutRadius,
                        endX = centerX + cos(endRadius) * doughnutRadius,
                        endY = centerY + sin(endRadius) * doughnutRadius,
                        startX2 = centerX + cos(endRadius) * cutoutRadius,
                        startY2 = centerY + sin(endRadius) * cutoutRadius;
                    var cmd = [
                        'M', startX, startY,
                        'A', doughnutRadius, doughnutRadius, 0, 1, 1, endX, endY, //Draw outer circle
                        'Z', //Close path
                        'M', startX2, startY2, //Move pointer
                        'A', cutoutRadius, cutoutRadius, 0, 1, 0, endX2, endY2, //Draw inner circle
                        'Z'
                    ];
                    cmd = cmd.join(' ');
                    return cmd;
                };

                function pathMouseEnter(e) {
                    var order = $(this).data().order;
                    $tip.text(data[order].title + ": " + data[order].value)
                        .fadeIn(200);
                    settings.onPathEnter.apply($(this), [e, data]);
                }

                function pathMouseLeave(e) {
                    $tip.hide();
                    settings.onPathLeave.apply($(this), [e, data]);
                }

                function pathMouseMove(e) {
                    $tip.css({
                        top: e.pageY + settings.tipOffsetY,
                        left: e.pageX - $tip.width() / 2 + settings.tipOffsetX
                    });
                }

                function drawPieSegments(animationDecimal) {
                    var startRadius = -PI / 2, //-90 degree
                        rotateAnimation = 1;
                    if (settings.animation && settings.animateRotate) rotateAnimation = animationDecimal; //count up between0~1

                    drawDoughnutText(animationDecimal, segmentTotal);

                    $pathGroup.attr("opacity", animationDecimal);

                    //If data have only one value, we draw hollow circle(#1).
                    if (data.length === 1 && (4.7122 < (rotateAnimation * ((data[0].value / segmentTotal) * (PI * 2)) + startRadius))) {
                        $paths[0].attr("d", getHollowCirclePath(doughnutRadius, cutoutRadius));
                        return;
                    }
                    for (var i = 0, len = data.length; i < len; i++) {
                        var segmentAngle = rotateAnimation * ((data[i].value / segmentTotal) * (PI * 2)),
                            endRadius = startRadius + segmentAngle,
                            largeArc = ((endRadius - startRadius) % (PI * 2)) > PI ? 1 : 0,
                            startX = centerX + cos(startRadius) * doughnutRadius,
                            startY = centerY + sin(startRadius) * doughnutRadius,
                            endX2 = centerX + cos(startRadius) * cutoutRadius,
                            endY2 = centerY + sin(startRadius) * cutoutRadius,
                            endX = centerX + cos(endRadius) * doughnutRadius,
                            endY = centerY + sin(endRadius) * doughnutRadius,
                            startX2 = centerX + cos(endRadius) * cutoutRadius,
                            startY2 = centerY + sin(endRadius) * cutoutRadius;
                        var cmd = [
                            'M', startX, startY, //Move pointer
                            'A', doughnutRadius, doughnutRadius, 0, largeArc, 1, endX, endY, //Draw outer arc path
                            'L', startX2, startY2, //Draw line path(this line connects outer and innner arc paths)
                            'A', cutoutRadius, cutoutRadius, 0, largeArc, 0, endX2, endY2, //Draw inner arc path
                            'Z' //Cloth path
                        ];
                        $paths[i].attr("d", cmd.join(' '));
                        startRadius += segmentAngle;
                    }
                }

                function drawDoughnutText(animationDecimal, segmentTotal) {
                    $summaryNumber
                        .css({
                            opacity: animationDecimal
                        })
                        .text((segmentTotal * animationDecimal).toFixed(1));
                }

                function animateFrame(cnt, drawData) {
                    var easeAdjustedAnimationPercent = (settings.animation) ? CapValue(easingFunction(cnt), null, 0) : 1;
                    drawData(easeAdjustedAnimationPercent);
                }

                function animationLoop(drawData) {
                    var animFrameAmount = (settings.animation) ? 1 / CapValue(settings.animationSteps, Number.MAX_VALUE, 1) : 1,
                        cnt = (settings.animation) ? 0 : 1;
                    requestAnimFrame(function() {
                        cnt += animFrameAmount;
                        animateFrame(cnt, drawData);
                        if (cnt <= 1) {
                            requestAnimFrame(arguments.callee);
                        } else {
                            settings.afterDrawed.call($this);
                        }
                    });
                }

                function Max(arr) {
                    return Math.max.apply(null, arr);
                }

                function Min(arr) {
                    return Math.min.apply(null, arr);
                }

                function isNumber(n) {
                    return !isNaN(parseFloat(n)) && isFinite(n);
                }

                function CapValue(valueToCap, maxValue, minValue) {
                    if (isNumber(maxValue) && valueToCap > maxValue) return maxValue;
                    if (isNumber(minValue) && valueToCap < minValue) return minValue;
                    return valueToCap;
                }
                return $this;
            };
        })(jQuery);
        var myConfig = {
            type: "bar",
            plot:{
                stacked:true,
                stackType:"normal"
            },
            scaleY:{
                minValue:0,
                maxValue:50000
            },
            scaleX:{
                labels:
                ["2015","2020","2025","2030","2035","2040"]

            },
            series: [
                {
                    values:[7775.90,7911.80,8129.60,8082.20,7917.80,7726.20]
                },
                {
                    values:[21589.10,23427.90,24684.90,25896.80,26944.40,27765.30]
                },
                {
                    values:[1821.5,2442.8,3207.9,4083.4,5016.9,6011.8]
                }
            ]
        };

        //Stacked Bar Chart function
        var margin = {top: 20, right: 160, bottom: 35, left: 30};

        var width = 700 - margin.left - margin.right,
            height = 300 - margin.top - margin.bottom;

        var svg = d3.select("#myChart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var data = [
            { year: "2015", redDelicious: "7775.90", mcintosh: "21589.10", oranges: "1821.5"},
            { year: "2020", redDelicious: "7911.80", mcintosh: "23427.90", oranges: "2442.8"},
            { year: "2025", redDelicious: "8129.60", mcintosh: "24684.90", oranges: "3207.9"},
            { year: "2030", redDelicious: "8082.20", mcintosh: "25896.80", oranges: "4083.4"},
            { year: "2035", redDelicious: "7917.80", mcintosh: "26944.40", oranges: "5016.9"},
            { year: "2040", redDelicious: "7726.20", mcintosh: "27765.30", oranges: "6011.8"},   
        ];
        var parse = d3.time.format("%Y").parse;
        var dataset = d3.layout.stack()(["redDelicious", "mcintosh", "oranges"].map(function(fruit) {
            return data.map(function(d) {
                return {x: parse(d.year), y: +d[fruit]};
            });
        }));
        var x = d3.scale.ordinal()
        .domain(dataset[0].map(function(d) { return d.x; }))
        .rangeRoundBands([10, width-10], 0.02);

        var y = d3.scale.linear()
        .domain([0, d3.max(dataset, function(d) {  return d3.max(d, function(d) { return d.y0 + d.y; });  })])
        .range([height, 0]);

        var colors = ["b33040", "#d25c4d", "#f2b447"];

        var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(5)
        .tickSize(-width, 0, 0)
        .tickFormat( function(d) { return d } );

        var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom")
        .tickFormat(d3.time.format("%Y"));

        svg.append("g")
            .attr("class", "y axis")
            .call(yAxis);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        var groups = svg.selectAll("g.cost")
        .data(dataset)
        .enter().append("g")
        .attr("class", "cost")
        .style("fill", function(d, i) { return colors[i]; });

        var rect = groups.selectAll("rect")
        .data(function(d) { return d; })
        .enter()
        .append("rect")
        .attr("x", function(d) { return x(d.x); })
        .attr("y", function(d) { return y(d.y0 + d.y); })
        .attr("height", function(d) { return y(d.y0) - y(d.y0 + d.y); })
        .attr("width", x.rangeBand())
        .on("mouseover", function() { tooltip.style("display", null); })
        .on("mouseout", function() { tooltip.style("display", "none"); })
        .on("mousemove", function(d) {
            var xPosition = d3.mouse(this)[0] - 15;
            var yPosition = d3.mouse(this)[1] - 25;
            tooltip.attr("transform", "translate(" + xPosition + "," + yPosition + ")");
            tooltip.select("text").text(d.y);
        });


        // Draw legend
        var legend = svg.selectAll(".legend")
        .data(colors)
        .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function(d, i) { return "translate(30," + i * 19 + ")"; });

        legend.append("rect")
            .attr("x", width - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", function(d, i) {return colors.slice().reverse()[i];});

        legend.append("text")
            .attr("x", width + 5)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "start")
            .text(function(d, i) { 
            switch (i) {
                case 0: return "> 65";
                case 1: return "15 - 64";
                case 2: return "0 - 14";
            }
        });


        // Prep the tooltip bits, initial display is hidden
        var tooltip = svg.append("g")
        .attr("class", "tooltip")
        .style("display", "none");

        // tooltip.append("rect")
        //   .attr("width", 60)
        //   .attr("height", 20)
        //   .attr("fill", "white")
        //   .style("opacity", 0.5);

        tooltip.append("text")
            .attr("x", 15)
            .attr("dy", "1.2em")
            .style("text-anchor", "middle")
            .attr("font-size", "12px")
            .attr("font-weight", "bold");

    </script>

</body>

</html>
